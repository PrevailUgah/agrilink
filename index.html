<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriLink Nigeria | Neural Supply Chain</title>
    
    <!-- 
        ðŸš€ ARCHITECTURE NOTE:
        Welcome to the AgriLink Neural Frontend.
        
        We are using a "Zero-Build" Single File Component (SFC) architecture here.
        Why? Because in the field (or at a Hackathon), speed is life. 
        We don't wait for 'npm install' or Webpack bundles. We ship.
        
        This makes the prototype universally portable and instantly demo-ready on any machine.
        Powered by React 18 + Tailwind via CDN.
    -->

    <!-- THE ENGINE ROOM (Libraries) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FONTS: Space Grotesk for that futuristic Afro-Tech vibe -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        /* --- GLOBAL AESTHETICS --- */
        body { 
            background-color: #0c0a09; 
            color: #e7e5e4; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; /* Lock the viewport, we control the scroll */
        }
        
        /* Typography System */
        h1, h2, h3, button.btn-font { font-family: 'Space Grotesk', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* --- SYSTEM BOOT SEQUENCE (Loader) --- */
        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000;
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-family: 'Space Grotesk', sans-serif;
            transition: opacity 0.8s ease-out;
        }
        .progress-bar {
            width: 300px; height: 4px; background: #333; margin-top: 20px;
            position: relative; overflow: hidden; border-radius: 2px;
        }
        .progress-fill {
            position: absolute; top: 0; left: 0; height: 100%; width: 0%;
            background: #10b981; /* AgriLink Green */
            animation: load 2.0s ease-in-out forwards;
        }
        @keyframes load { 0% { width: 0%; } 100% { width: 100%; } }
        
        /* --- CYBERPUNK ANKARA THEME --- */
        /* This is our visual signature. Tech meets Tradition. */
        .ankara-bg {
            background-color: #1c1917;
            background-image: radial-gradient(#065f46 1px, transparent 1px), radial-gradient(#d97706 1px, transparent 1px);
            background-position: 0 0, 20px 20px;
            background-size: 40px 40px;
        }
        
        /* Glassmorphism for depth */
        .glass-panel {
            background: rgba(28, 25, 23, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        
        /* The Scanning Eye - Neural Visualizer */
        .scan-beam {
            position: absolute; width: 100%; height: 10px;
            background: linear-gradient(to bottom, transparent, #10b981, transparent);
            animation: beam 2.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            z-index: 0;
        }
        @keyframes beam { 0% { top: -10%; opacity: 0; } 20% { opacity: 1; } 100% { top: 110%; opacity: 0; } }

        /* --- WHATSAPP CLONE UTILS --- */
        /* Recreating the familiar interface farmers already trust */
        .wa-bg {
            background-color: #efeae2;
            background-image: url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png");
            background-repeat: repeat;
            opacity: 0.9;
        }
        .wa-header { background-color: #008069; }
        .wa-in { background-color: #ffffff; border-radius: 0px 10px 10px 10px; }
        .wa-out { background-color: #e7ffdb; border-radius: 10px 0px 10px 10px; }
        
        /* Clean scrollbars for sleek look */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    
    <!-- INITIALIZATION OVERLAY -->
    <div id="boot-screen">
        <div class="text-white text-2xl font-bold tracking-tight mb-2">AgriLink<span class="text-green-500">.NG</span></div>
        <div class="text-stone-400 text-sm tracking-widest uppercase mb-4">CONNECTING FARMERS AND BUYERS SECURELY...</div>
        <div class="progress-bar"><div class="progress-fill"></div></div>
        <div class="mt-4 text-stone-600 text-[10px] font-mono">ESTABLISHING ENCRYPTED UPLINK_</div>
    </div>

    <!-- REACT ROOT -->
    <div id="root" style="opacity: 0; transition: opacity 1s ease-in;"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONOGRAPHY SYSTEM ---
        // Lightweight SVG components. No heavy icon libraries needed.
        const Icon = ({ size = 20, className = "", children }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>);
        
        const Sprout = (p) => <Icon {...p}><path d="M7 20h10"/><path d="M10 20c5.5-2.5.8-6.4 3-10"/><path d="M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.2.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z"/><path d="M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z"/></Icon>;
        const Brain = (p) => <Icon {...p}><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/></Icon>;
        const Store = (p) => <Icon {...p}><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></Icon>;
        const ArrowLeft = (p) => <Icon {...p}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></Icon>;
        const Lock = (p) => <Icon {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></Icon>;
        const TrendingUp = (p) => <Icon {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></Icon>;
        const User = (p) => <Icon {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>;
        const Star = (p) => <Icon {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></Icon>;
        const Phone = (p) => <Icon {...p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></Icon>;
        const Video = (p) => <Icon {...p}><path d="m22 8-6 4 6 4V8Z"/><rect x="2" y="6" width="14" height="12" rx="2" ry="2"/></Icon>;
        const MoreVert = (p) => <Icon {...p}><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></Icon>;
        const Mic = (p) => <Icon {...p}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="23"/><line x1="8" x2="16" y1="23" y2="23"/></Icon>;
        const Paperclip = (p) => <Icon {...p}><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></Icon>;
        const SendWA = (p) => <Icon {...p}><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></Icon>;
        const Camera = (p) => <Icon {...p}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Icon>;
        const Checks = (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size || 16} height={p.size || 16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={p.className}><path d="M18 6 7 17l-5-5"/><path d="m22 10-7.5 7.5L13 16"/></svg>;

        // --- THE SOURCE OF TRUTH (In-Memory State) ---
        // For this demo, we mock the DB. In production, this pulls from our FastAPI backend.
        let GLOBAL_MARKET = [
            { id: 1, item: "Onions", qty: 50, unit: "Baskets", zone: "North-West (Kano)", price: 8500, time: "2m ago", seller: "Sani Farms", type: "supply" },
            { id: 2, item: "Rice 50kg", qty: 200, unit: "Bags", zone: "Lagos", price: 65000, time: "10m ago", seller: "Mega Stores", type: "demand" },
            { id: 3, item: "Yams", qty: 400, unit: "Tubers", zone: "Benue", price: 1200, time: "45m ago", seller: "Mama Nkechi", type: "supply"}
        ];

        let DRIVERS = [
            { id: 1, name: "Musa Aliyu", vehicle: "Canter Truck (5 Tons)", location: "Kano", rating: 4.8, trips: 142, status: "Available" },
            { id: 2, name: "Chinedu & Sons", vehicle: "Lorry (10 Tons)", location: "Lagos", rating: 4.9, trips: 310, status: "Busy" },
            { id: 3, name: "Bello Logistics", vehicle: "Pick-up Van", location: "Zaria", rating: 4.5, trips: 89, status: "Available" }
        ];

        let NEW_NOTIFICATION = false; 

        // --- COMPONENTS ---

        // 1. ACCESS GATEWAY (Identity Layer)
        // Simple role-based entry point. No password friction for the demo.
        const Login = ({ setRole }) => (
            <div className="h-screen w-full ankara-bg flex items-center justify-center p-6 animate-in fade-in zoom-in duration-700">
                <div className="max-w-5xl w-full">
                    <header className="mb-16 text-center">
                        <div className="inline-flex items-center gap-3 bg-white/5 border border-white/10 px-6 py-2 rounded-full mb-6 backdrop-blur-md">
                            <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            <span className="text-xs uppercase tracking-widest text-green-400 font-bold">Pan-African Logistics Network</span>
                        </div>
                        <h1 className="text-6xl md:text-8xl font-bold text-white mb-2 tracking-tighter">AgriLink<span className="text-green-500">.NG</span></h1>
                        <p className="text-xl text-stone-400 font-light">Bridging the gap between Rural Harvest & Urban Demand.</p>
                    </header>

                    <div className="grid md:grid-cols-3 gap-6">
                        {[
                            { role: 'whatsapp', icon: Phone, label: "WhatsApp Bot", desc: "For Farmers & Buyers on the go. Buy or Sell via text.", color: "text-green-500", border: "hover:border-green-500" },
                            { role: 'market', icon: Store, label: "Market Feed", desc: "Live commodity board. Real-time Supply & Demand.", color: "text-amber-500", border: "hover:border-amber-500", notify: NEW_NOTIFICATION },
                            { role: 'admin', icon: Brain, label: "Logistics Core", desc: "AI Dispatch System. Fleet Management.", color: "text-purple-500", border: "hover:border-purple-500", notify: NEW_NOTIFICATION }
                        ].map(card => (
                            <button key={card.role} onClick={() => setRole(card.role)} className={`glass-panel p-8 rounded-2xl text-left transition-all duration-300 hover:-translate-y-2 border border-white/5 ${card.border} group relative`}>
                                {card.notify && <span className="absolute top-4 right-4 w-3 h-3 bg-red-500 rounded-full animate-pulse shadow-lg shadow-red-500/50"></span>}
                                <card.icon size={40} className={`${card.color} mb-6`} />
                                <h3 className="text-2xl font-bold text-white mb-2 btn-font">{card.label}</h3>
                                <p className="text-stone-400 text-sm leading-relaxed">{card.desc}</p>
                            </button>
                        ))}
                    </div>
                </div>
            </div>
        );

        // 2. WHATSAPP NEURAL BRIDGE
        // A simulated interface because farmers prefer chat over complex dashboards.
        const WhatsAppInterface = ({ onBack }) => {
            const [messages, setMessages] = useState([
                { id: 1, text: "Welcome to AgriLink! ðŸŒ¾\n\nI connect you to the market instantly.", sender: "bot", time: "09:30" },
                { id: 2, text: "Are you Buying ðŸ›’ or Selling ðŸŒ¾ today?", sender: "bot", time: "09:30" }
            ]);
            const [input, setInput] = useState("");
            
            // Finite State Machine for the chat flow
            const [flowState, setFlowState] = useState({ step: 0, mode: '', location: '', product: '', qty: 0, unit: '', price: 0 });
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            useEffect(scrollToBottom, [messages]);
            
            const handleSend = () => {
                if(!input.trim()) return;
                
                // Add User Message
                const userMsg = { id: Date.now(), text: input, sender: "user", time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), status: 'sent' };
                setMessages(prev => [...prev, userMsg]);
                const currentInput = input; 
                setInput("");

                // Simulate Network Delay (Authenticity is key)
                setTimeout(() => {
                    setMessages(prev => prev.map(m => m.id === userMsg.id ? {...m, status: 'read'} : m));
                }, 800);

                // Bot Logic (The "Neural" part)
                setTimeout(() => {
                    const lower = currentInput.toLowerCase();
                    const { step } = flowState;
                    let botResponse = "";
                    let nextState = { ...flowState };

                    // STATE 0: Intent Classification
                    if (step === 0) {
                        if (lower.includes("sell")) {
                            botResponse = "Selling ðŸŒ¾. Which State are you located in?";
                            nextState = { step: 1, mode: 'supply' };
                        } else if (lower.includes("buy")) {
                            botResponse = "Buying ðŸ›’. Which State do you need delivery to?";
                            nextState = { step: 4, mode: 'demand' };
                        } else {
                            botResponse = "Please type 'Buying' or 'Selling' to continue.";
                        }
                    } 
                    
                    // STATE 1: Location Extraction
                    else if (step === 1) {
                        botResponse = `Okay, location set to ${currentInput}. âœ…\n\nWhat are you selling? (e.g., '500 baskets of Tomatoes')`;
                        nextState = { ...flowState, step: 2, location: currentInput };
                    }

                    // STATE 2: Product/Qty Parsing (NLP Mock)
                    else if (step === 2) {
                        const { product, qty, unit } = parseProduct(currentInput);
                        botResponse = `Got it. ${qty} ${unit} of ${product}. ðŸ“\n\nWhat is your price per ${unit.slice(0, -1)}? (e.g. 12000)`;
                        nextState = { ...flowState, step: 3, product, qty, unit };
                    }

                    // STATE 3: Pricing & Fulfillment
                    else if (step === 3) {
                        const price = parseInt(currentInput.replace(/[^0-9]/g, '')) || 0;
                        // Push to Global State immediately
                        GLOBAL_MARKET.unshift({ 
                            id: Date.now(), item: flowState.product, qty: flowState.qty, unit: flowState.unit, zone: flowState.location, price: price, 
                            time: "Just Now", seller: "Farmer via WhatsApp", type: "supply" 
                        });
                        NEW_NOTIFICATION = true;

                        botResponse = `âœ… **Harvest Listed!**\n\nItem: ${flowState.qty} ${flowState.unit} of ${flowState.product}\nLocation: ${flowState.location}\nPrice: â‚¦${price.toLocaleString()} / ${flowState.unit.slice(0, -1)}\n\nðŸš› **Available Drivers Nearby:**\n1. **Musa Aliyu** (Canter Truck)\n   ðŸ“ 15 mins away â€¢ â­ 4.8\n\nReply with 1 to book.`;
                        nextState = { step: 0, mode: '', location: '' }; 
                    }

                    // ... (Buyer Logic omitted for brevity) ...
                    else if (step === 4) {
                        botResponse = `Noted, ${currentInput}. âœ…\n\nWhat do you need? (e.g., '20 bags of Rice')`;
                        nextState = { ...flowState, step: 5, location: currentInput };
                    } else if (step === 5) {
                        const { product, qty, unit } = parseProduct(currentInput);
                        GLOBAL_MARKET.unshift({ id: Date.now(), item: product, qty: qty, unit: unit, zone: flowState.location, price: 0, time: "Just Now", seller: "Buyer via WhatsApp", type: "demand" });
                        NEW_NOTIFICATION = true;
                        botResponse = `âœ… **Request Broadcasted!**\n\nWanted: ${qty} ${unit} of ${product}\nLocation: ${flowState.location}\n\nNotifying Farmers... ðŸ“¡`;
                        nextState = { step: 0, mode: '', location: '' }; 
                    }

                    if (botResponse) {
                        setMessages(prev => [...prev, { 
                            id: Date.now()+1, sender: "bot", time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), 
                            text: botResponse 
                        }]);
                        setFlowState(nextState);
                    }

                }, 1500);
            };

            // Simple NLP parser for demo
            const parseProduct = (text) => {
                const lower = text.toLowerCase();
                let product = "Produce";
                let unit = "Units";

                if(lower.includes("onion")) { product = "Red Onions"; unit = "Baskets"; }
                else if(lower.includes("tomato")) { product = "Tomatoes"; unit = "Baskets"; }
                else if(lower.includes("pepper")) { product = "Red Pepper"; unit = "Baskets"; }
                else if(lower.includes("yam")) { product = "Tubers of Yam"; unit = "Tubers"; }
                else if(lower.includes("rice")) { product = "Rice (50kg)"; unit = "Bags"; }
                
                const qtyMatch = text.match(/\d+/);
                const qty = qtyMatch ? parseInt(qtyMatch[0]) : 100;
                return { product, qty, unit };
            };

            return (
                <div className="h-screen w-full bg-black flex items-center justify-center p-2">
                    <div className="w-full md:w-[380px] h-full md:h-[85vh] bg-[#efeae2] md:rounded-[30px] flex flex-col overflow-hidden relative shadow-2xl">
                        {/* Header */}
                        <div className="wa-header p-3 flex items-center gap-3 text-white shadow-md z-10 shrink-0">
                            <button onClick={onBack} className="flex items-center gap-1 -ml-1 hover:bg-black/10 rounded p-1 transition">
                                <ArrowLeft size={24} />
                            </button>
                            <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center text-[#008069] font-bold text-lg">A</div>
                            <div className="flex-1">
                                <h3 className="font-bold text-lg leading-none">AgriLink Bot</h3>
                                <p className="text-xs opacity-80">Official Business Account</p>
                            </div>
                            <div className="flex gap-4 pr-2"><Video size={24} /><Phone size={22} /><MoreVert size={22} /></div>
                        </div>
                        
                        {/* Chat Area */}
                        <div className="flex-1 wa-bg p-4 overflow-y-auto relative flex flex-col">
                            <div className="flex justify-center mb-6 shrink-0">
                                <div className="bg-[#ffeb3b]/90 text-stone-800 text-[10px] px-3 py-1 rounded-lg text-center shadow-sm max-w-[80%]">ðŸ”’ Messages are end-to-end encrypted.</div>
                            </div>
                            {messages.map(msg => (
                                <div key={msg.id} className={`flex mb-2 ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[80%] p-2 px-3 text-sm relative shadow-sm ${msg.sender === 'user' ? 'wa-out' : 'wa-in'}`}>
                                        <p className="text-stone-900 pb-1 whitespace-pre-wrap">{msg.text}</p>
                                        <div className="flex justify-end items-center gap-1"><span className="text-[10px] text-stone-500">{msg.time}</span>{msg.sender === 'user' && (<Checks size={14} className={msg.status === 'read' ? 'text-blue-500' : 'text-stone-400'} />)}</div>
                                    </div>
                                </div>
                            ))}
                            <div ref={messagesEndRef} />
                        </div>

                        {/* Input Area */}
                        <div className="bg-transparent p-2 pb-4 md:pb-2 flex items-end gap-2 w-full shrink-0 z-20">
                            <div className="flex-1 bg-white rounded-full flex items-center p-1.5 shadow-sm min-h-[45px] ml-1 mb-1">
                                <button className="text-stone-400 p-2"><Icon size={24}>ðŸ˜Š</Icon></button>
                                <textarea value={input} onChange={e => setInput(e.target.value)} placeholder="Message" className="flex-1 bg-transparent outline-none text-stone-800 text-base max-h-24 resize-none overflow-y-auto py-2" rows={1} onKeyDown={e => e.key === 'Enter' && !e.shiftKey && handleSend()} />
                                <div className="flex items-center gap-3 pr-2 text-stone-500">
                                    <button className="text-stone-500"><Paperclip size={22} className="-rotate-45" /></button>
                                    {input.length === 0 && (<button className="text-stone-500"><Camera size={22} /></button>)}
                                </div>
                            </div>
                            <button onClick={input ? handleSend : null} className={`w-12 h-12 rounded-full flex items-center justify-center text-white shadow-md transition-all mb-1 mr-1 flex-shrink-0 bg-[#008069]`}>{input ? <SendWA size={22} className="ml-1" /> : <Mic size={22} />}</button>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. MARKET FEED DASHBOARD
        // The real-time view of Nigeria's food movement.
        const MarketDashboard = ({ onBack }) => {
            const [view, setView] = useState('commodities');
            const [showAuthModal, setShowAuthModal] = useState(false);

            return (
                <div className="h-screen w-full bg-stone-100 text-stone-900 p-8 overflow-auto relative">
                    <header className="flex justify-between items-center mb-8 max-w-5xl mx-auto">
                        <div>
                            <h2 className="text-3xl font-bold text-stone-900 flex items-center gap-2 btn-font"><Store className="text-amber-600"/> Market Feed</h2>
                            <p className="text-stone-500 text-sm">Real-time data from 14 states.</p>
                        </div>
                        <div className="flex gap-4">
                            <div className="flex bg-white rounded-lg p-1 border border-stone-200 shadow-sm">
                                <button onClick={() => setView('commodities')} className={`px-4 py-1.5 rounded-md text-sm font-bold transition ${view === 'commodities' ? 'bg-amber-100 text-amber-700' : 'text-stone-500 hover:text-stone-800'}`}>Commodities</button>
                                <button onClick={() => setView('drivers')} className={`px-4 py-1.5 rounded-md text-sm font-bold transition ${view === 'drivers' ? 'bg-blue-100 text-blue-700' : 'text-stone-500 hover:text-stone-800'}`}>Drivers</button>
                            </div>
                            <button onClick={onBack} className="text-stone-500 font-bold px-4 py-2 hover:bg-stone-200 rounded flex items-center gap-2"><ArrowLeft size={20}/> Back</button>
                        </div>
                    </header>
                    <div className="max-w-5xl mx-auto">
                        {view === 'commodities' && (
                            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {GLOBAL_MARKET.map(m => (
                                    <div key={m.id} className="bg-white p-6 rounded-xl shadow-sm border border-stone-200 hover:shadow-md transition flex flex-col justify-between animate-in fade-in slide-in-from-bottom-4 duration-500 relative overflow-hidden">
                                        {/* Status Tags */}
                                        {m.type === 'demand' && <div className="absolute top-0 right-0 bg-orange-500 text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg tracking-widest">WANTED</div>}
                                        {m.type === 'supply' && <div className="absolute top-0 right-0 bg-green-500 text-white text-[10px] font-bold px-3 py-1 rounded-bl-lg tracking-widest">HARVEST</div>}
                                        
                                        <div>
                                            <div className="flex justify-between items-start mb-2"><span className={`text-[10px] uppercase font-bold px-2 py-1 rounded ${m.type === 'demand' ? "bg-orange-100 text-orange-600" : "bg-green-100 text-green-600"}`}>{m.item.split(' ')[0]}</span><span className="text-xs text-stone-400">{m.time}</span></div>
                                            <h3 className="font-bold text-2xl mb-1">{m.type === 'supply' ? `${m.qty} ${m.unit || 'Units'}` : m.item}</h3>
                                            <p className="text-sm text-stone-500 flex items-center gap-1">{m.type === 'demand' ? <TrendingUp size={14} className="text-orange-500"/> : <Sprout size={14} className="text-green-500"/>} {m.seller}</p>
                                            <p className="text-xs text-stone-400 mt-1 uppercase tracking-wide">{m.zone}</p>
                                        </div>

                                        <div className="mt-4 pt-4 border-t border-stone-100 flex justify-between items-center">
                                            {m.type === 'supply' ? (<p className="font-bold text-xl text-green-700">â‚¦{m.price.toLocaleString()} <span className="text-xs text-stone-400 font-normal">/ {m.unit.slice(0,-1)}</span></p>) : (<p className="font-bold text-sm text-orange-600 tracking-wide">OPEN REQUEST</p>)}
                                            <button onClick={() => setShowAuthModal(true)} className="text-xs bg-black text-white px-3 py-2 rounded font-bold hover:bg-stone-800">{m.type === 'demand' ? 'FULFILL' : 'BID NOW'}</button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                        {/* Driver View Logic... */}
                        {view === 'drivers' && (
                            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {DRIVERS.map(d => (
                                    <div key={d.id} className="bg-white p-6 rounded-xl shadow-sm border border-stone-200 hover:shadow-md transition animate-in fade-in slide-in-from-bottom-4 duration-500">
                                        <div className="flex items-center gap-4 mb-4"><div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600"><User size={24} /></div><div><h3 className="font-bold text-lg leading-none">{d.name}</h3><div className="flex items-center gap-1 text-xs text-stone-500 mt-1"><Star size={12} className="text-yellow-400 fill-yellow-400" /><span>{d.rating}</span><span>â€¢</span><span>{d.trips} Trips</span></div></div></div>
                                        <div className="space-y-2 mb-4">
                                            <div className="flex justify-between text-sm"><span className="text-stone-500">Vehicle</span><span className="font-medium">{d.vehicle}</span></div>
                                            <div className="flex justify-between text-sm"><span className="text-stone-500">Location</span><span className="font-medium">{d.location}</span></div>
                                            <div className="flex justify-between text-sm"><span className="text-stone-500">Status</span><span className={`font-bold text-xs px-2 py-0.5 rounded ${d.status === 'Available' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{d.status}</span></div>
                                        </div>
                                        <button className="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg text-sm transition">Book Driver</button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    {/* Security Modal */}
                    {showAuthModal && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-300">
                            <div className="glass-panel p-8 rounded-2xl max-w-md w-full text-center border border-green-500/30">
                                <div className="mx-auto w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mb-4"><Lock size={32} className="text-green-500" /></div>
                                <h3 className="text-2xl font-bold text-white mb-2 btn-font">Secure Gateway</h3>
                                <p className="text-stone-400 mb-8 text-sm">To verify transaction integrity, please authenticate your identity.</p>
                                <div className="space-y-3"><button className="w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl transition">Login to AgriLink ID</button><button className="w-full py-3 bg-transparent border border-stone-600 hover:border-white text-white font-bold rounded-xl transition">Create Neural ID</button></div>
                                <button onClick={() => setShowAuthModal(false)} className="mt-6 text-stone-500 hover:text-white text-sm">Cancel</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 4. ADMIN NEURAL CORE
        // The command center for dispatching.
        const AdminPanel = ({ onBack }) => {
            const [logs, setLogs] = useState(["Connecting to Zaria Node...", "Lagos Hub: Online", "Prices synced with Mile 12 Market."]);
            const [scanning, setScanning] = useState(false);
            const scrollRef = useRef(null);
            
            const triggerScan = () => {
                setScanning(true);
                setLogs([]);
                const newestItem = GLOBAL_MARKET[0]; 
                const steps = ["Scanning North-West Zone...", "Analyzing WhatsApp Gateway...", `Detected: ${newestItem.qty} Units (${newestItem.item}) @ ${newestItem.zone}`, "Calculating Transport Costs (Diesel: â‚¦1,200/L)...", "Buyer Match: Shoprite Alausa (Lagos)", "DISPATCHING FLEET: TRUCK-NG-404"];
                steps.forEach((step, i) => { setTimeout(() => { setLogs(prev => [...prev, `> ${step}`]); if (i === steps.length - 1) setScanning(false); }, i * 800 + 500); });
            };
            
            return (
                <div className="h-screen w-full bg-stone-950 flex flex-col text-stone-300 font-mono overflow-hidden">
                    <nav className="h-16 border-b border-stone-800 flex items-center justify-between px-6 bg-stone-900/50"><div className="flex items-center gap-3"><Brain className="text-purple-500" /><span className="font-bold text-white tracking-widest">AgriLink <span className="text-purple-400 font-mono">CORE</span></span></div><div className="flex gap-4"><button onClick={onBack} className="text-stone-500 hover:text-white flex items-center gap-2 transition"><ArrowLeft size={18} /> Back</button></div></nav>
                    <div className="flex-1 flex">
                        <div className="flex-1 relative bg-black border-r border-stone-800">
                            {scanning && <div className="scan-beam"></div>}
                            <div className="absolute inset-0 flex items-center justify-center opacity-20">
                                <div className="grid grid-cols-2 gap-4 w-2/3 h-2/3">
                                    <div className="border-2 border-dashed border-stone-600 rounded-tl-[100px] p-6 flex items-start justify-start"><span className="text-4xl font-bold">NORTH</span></div>
                                    <div className="border-2 border-dashed border-stone-600 rounded-tr-[50px] p-6 flex items-start justify-end"><span className="text-4xl font-bold text-stone-700">EAST</span></div>
                                    <div className="border-2 border-dashed border-stone-600 rounded-bl-[50px] p-6 flex items-end justify-start"><span className="text-4xl font-bold text-green-900">WEST</span></div>
                                    <div className="border-2 border-dashed border-stone-600 rounded-br-[100px] p-6 flex items-end justify-end"><span className="text-4xl font-bold text-stone-700">DELTA</span></div>
                                </div>
                            </div>
                            <div className="absolute bottom-8 left-8 space-y-4"><div className="bg-stone-900/80 p-4 rounded-lg border-l-4 border-green-500 backdrop-blur-md w-64"><p className="text-xs text-stone-500 uppercase">Total Volume Moved</p><p className="text-2xl font-bold text-white">45,000 Tons</p></div></div>
                        </div>
                        <div className="w-1/3 bg-stone-900 flex flex-col border-l border-stone-800">
                            <div className="p-6 border-b border-stone-800"><button onClick={triggerScan} className="w-full py-4 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl shadow-lg shadow-purple-900/20 transition flex items-center justify-center gap-2"><Brain size={20}/> INITIATE NEURAL SCAN</button></div>
                            <div className="flex-1 p-6 overflow-y-auto font-mono text-xs"><p className="text-stone-500 mb-4 border-b border-stone-800 pb-2">SYSTEM LOGS_</p>{logs.map((log, i) => <div key={i} className="mb-2 text-green-400">{log}</div>)}<div ref={scrollRef}></div></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5. MAIN APP ORCHESTRATOR
        const App = () => {
            const [role, setRole] = useState(null);
            
            // Boot Screen Logic
            useEffect(() => {
                setTimeout(() => {
                    document.getElementById('boot-screen').style.display = 'none';
                    document.getElementById('root').style.opacity = '1';
                }, 2200); 
            }, []);

            return (
                <div className="antialiased">
                    {!role && <Login setRole={setRole} />}
                    {role === 'whatsapp' && <WhatsAppInterface onBack={() => setRole(null)} />}
                    {role === 'market' && <MarketDashboard onBack={() => setRole(null)} />}
                    {role === 'admin' && <AdminPanel onBack={() => setRole(null)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
